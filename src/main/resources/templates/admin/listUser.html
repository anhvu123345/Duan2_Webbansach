<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="employee/layout :: head">
<style type="text/css">
</style>
</head>
<body>

	<div id="wrapper">

		<nav th:replace="employee/layout :: sidebar"></nav>

		<div id="page-wrapper">
			<div class="row">
				<div class="col-sm-12">
					<h3 class="page-header">Quản lý tài khoản</h3>
				</div>
				<!-- /.col-sm-12 -->
			</div>

			<div class="row">
				<div class="col-sm-12">
					<div th:if="${success}"
						class="row alert alert-success alert-dismissible">
						<button type="button" class="close" data-dismiss="alert">
							<span>&times;</span>
						</button>
						<span th:text="${success}"></span>
					</div>

					<div class="panel panel-primary">
						<div class="panel-heading">Quản lý tài khoản</div> <div class="panel-heading"><input class="form-control round-form"  type="text" id="myInput" onkeyup="myFunction()" name="s" placeholder="Tìm Kiếm...."/></div> 
						<!-- /.panel-heading -->
						<div class="panel-body">
						<script type="text/javascript"> 
						function myFunction() {
							  // Declare variables 
							  var input, filter, table, tr, td, i, k;
							  input = document.getElementById("myInput");
							  filter = input.value.toUpperCase();
							  table = document.getElementById("dataTables-example");
							  tr = table.getElementsByTagName("tr");
							  // Loop through all table rows, and hide those who don't match the search query
							  for (i = 0; i < tr.length; i++) {
								  td = tr[i].getElementsByTagName("td")[2];
							    if (td) {
							      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
							        tr[i].style.display = "";
							      } else {
							        tr[i].style.display = "none";
							      }
							    } 
							  }
							}
						</script>
							<th:block th:if="${#lists.isEmpty(Listuser.pageList)}">
								<h3>No employee</h3>
							</th:block>
							
								<form action="#" th:action="@{/user/setrole}"
									th:object="${userRole}" method="POST">
									<th:block th:unless="${#lists.isEmpty(Listuser.pageList)}">
									<nav class="row justify-content-center wow fadeIn"
									data-wow-delay="0.2s">
									<table width="100%"
										class="table table-striped table-bordered"
										id="dataTables-example">
										<thead>
											<tr>
												<th width="">STT</th>
												<th width="">Mã</th>
												<th width="">Email</th>
												<th width="">Họ</th>
												<th width="">Tên</th>
												<th width="">Loại Tài Khoản</th>
												<th width="">Tùy chọn</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="user, lister :  ${Listuser.pageList}">
											<td th:text="${lister.count}"></td>
												<td th:text="${user.userid}"></td>
												<td th:text="${user.email}"></td>
												<td th:text="${user.fristname}"></td>
												<td th:text="${user.fullname}"></td>
												<!-- <=============Dùng css hiển thị radio cho admin và user, listuser là list được tạo trong UserController, [lists.index] dùng để đặt số thứ tự tăng dần theo số lượng tài khoản===============> -->
												<td style="text-align: center; vertical-align: middle">
													<div class="switch">
														<input type="radio" class="switch-input"
															th:name="${'listuser[' + lister.index +'].role'}"
															th:id="${'week'+ lister.index}"
															th:checked="${user.role == 'ROLE_USER'}"
															value="ROLE_USER"> <label
															th:for="${'week'+ lister.index}"
															class="switch-label switch-label-off">USER</label> <input
															type="radio" class="switch-input"
															th:name="${'listuser[' + lister.index +'].role'}"
															th:id="${'day'+ lister.index}"
															th:checked="${user.role == 'ROLE_EMPLOY'}"
															value="ROLE_EMPLOY"> <label
															th:for="${'day'+ lister.index}"
															class="switch-label switch-label-mid">EMPLOY</label> <input
															type="radio" class="switch-input"
															th:name="${'listuser[' + lister.index +'].role'}"
															th:checked="${user.role == 'ROLE_ADMIN'}"
															value="ROLE_ADMIN" th:id="${'month'+ lister.index}">
														<label th:for="${'month'+ lister.index}"
															class="switch-label switch-label-on">ADMIN</label> <span
															class="switch-selection"></span>
													</div>
												</td>
												<!-- <=================================================================================================================> -->


												<!-- <=============<td> ẩn nút input giá trị để save tài khoản giúp thay đổi ROLE không mất dữ liệu===============> -->
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].email'}"
													th:value="${user.email}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].userid'}"
													th:value="${user.userid}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].fristname'}"
													th:value="${user.fristname}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].fullname'}"
													th:value="${user.fullname}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].password'}"
													th:value="${user.password}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].token'}"
													th:value="${user.token}" /></td>
												<td style="display: none"><input type="hidden"
													th:name="${'listuser[' + lister.index +'].active'}"
													th:value="${user.active}" /></td>
												<!-- <=================================================================================================================> -->
												<td>
													<ul>
														<li style="list-style: none"><a
															th:href="@{/admin/user/{id}/delete(id=${user.userid})}"
															class="btn btn-danger">Xóa</a></li>
													</ul>
												</td>

											</tr>
										</tbody>


									</table>
									<ul class="pagination">
										<li
											th:class="${currentIndex == 1}? 'page-item disabled' : 'page-item'">
											<a class="page-link" th:href="@{/admin/userlist/page/1}">First</a>
										</li>
										<li
											th:class="${currentIndex == 1}? 'page-item disabled': 'page-item' ">
											<a class="page-link" aria-label="Previous"
											th:href="@{|${baseUrl}${currentIndex - 1}|}"
											title='Go to previous page'><span aria-hidden="true">«</span>
												<span class="sr-only">Previous</span></a>
										</li>
										<li th:each="item : ${#numbers.sequence(beginIndex,endIndex)}"
											th:class="${item == currentIndex ? 'page-item active' :'page-item' }">
											<a class="page-link" th:href="@{|${baseUrl}${item}|}"> <span
												th:text='${item}'>1</span>
										</a>
										</li>
										<li
											th:class="${currentIndex == totalPageCount}? 'page-item disabled': 'page-item'">
											<a class="page-link" aria-label="Next"
											th:href="@{|${baseUrl}${currentIndex + 1}|}"
											title='Go to next page'><span aria-hidden="true">»</span>
												<span class="sr-only">Next</span></a>
										</li>
										<li
											th:class="${currentIndex == totalPageCount}? 'page-item disabled':'page-item'">
											<a class="page-link"
											th:href="@{|${baseUrl}${totalPageCount}|}">Last</a>
										</li>
									</ul>
									</nav>
										</th:block>
									<!-- <============= Script giúp thông báo Sửa dổi chức năng tài khoản thành công===============> -->
									<script type="text/javascript">
										function Myclick() {
											swal({
												text : 'Lưu thành công!',
												buttons : false,
												icon : "success",
												showCancelButton : false,
												showConfirmButton : false
											})
													.then(
															function() {
																document
																		.getElementById(
																				"submit1")
																		.click();
															})
										}
									</script>
									<div align="center">
										<a type="submit" onclick="Myclick()" class="btn btn-primary">
											<i class="fa fa-save"></i>Lưu
										</a> <input style="display: none" id="submit1" type="submit" />
									</div>
								</form>
								<!-- /.table-responsive -->
						</div>
						<!-- /.panel-body -->
					</div>
					<!-- /.panel -->
				</div>
				<!-- /.col-sm-12 -->
			</div>
			<!-- /.row -->
		</div>
		<!-- /#page-wrapper -->

	</div>

</body>
</html>